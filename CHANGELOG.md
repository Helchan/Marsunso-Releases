# 更新日志

本文档记录 Marsunso 书签快捷搜索插件的所有版本变更历史。

## [1.2.8] - 2026-02-13

### Bug修复

#### 修复搜索输入框光标位置重置问题
**问题描述**：
- 在搜索面板输入框中输入内容后，将光标移动到中间位置再输入新字符
- 光标会自动跳转到末尾，导致无法在指定位置编辑

**根本原因**：
- `focusSearchInputToEnd()` 函数在每次搜索结果渲染后都会被调用
- 该函数会强制将光标移动到输入框末尾
- 即使用户正在输入框中编辑，光标位置也会被重置

**修复方案**：
- 在 `focusSearchInputToEnd()` 函数中增加焦点检测
- 当焦点已在搜索输入框中时，不重置光标位置
- 仅在焦点不在输入框时（如从对话框、菜单、其他窗口切换回来）才聚焦并移到末尾

**修复代码**：
```javascript
function focusSearchInputToEnd() {
  if (hasPopupDialog()) return;
  
  // 焦点已在搜索框中时，不重置光标位置（用户正在编辑）
  if (document.activeElement === searchInput) return;
  
  searchInput.focus();
  // ...
}
```

**修复效果**：
- 用户正在输入时，光标位置保持不变
- 从其他地方切换回来时，仍能自动聚焦到末尾

### 影响文件

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `manifest.json` | 修改 | 版本号更新：1.2.7 → 1.2.8 |
| `popup.js` | 修改 | 修复 focusSearchInputToEnd() 函数，增加焦点检测逻辑 |

---

## [1.2.7] - 2025-01-27

### 架构优化

#### 快捷键配置化管理
本次更新将所有功能快捷键（除浏览器插件激活快捷键 Ctrl+K/Command+K 外）统一迁移到配置文件中管理，支持用户自定义快捷键组合。

**核心改进**：
- 在 `config.js` 的 `DEFAULT_CONFIG` 中新增 `keyBindings` 配置项
- 将原来硬编码在 `popup.js` 中的快捷键全部改为配置驱动
- 支持跨平台修饰键自动适配（Mac 用 Command，其他平台用 Ctrl）

**配置结构**：
```javascript
keyBindings: {
  // 配置格式: { modifiers: ['cmdOrCtrl', 'alt', 'shift'], key: 'KeyboardEvent.key值' }
  
  // 搜索面板 (Search Panel) - 10个快捷键
  moveUp, moveDown, jumpToFirst, jumpToLast,
  navigateUp, navigateDown,
  openItem, openInBackground, clearInput, closePanel,
  
  // 右键菜单 (Context Menu) - 1个
  hideContextMenu,
  
  // 编辑对话框 (Edit Dialog) - 6个
  editSave, editCancel,
  treeNavigateUp, treeNavigateDown, treeExpand, treeCollapse,
  
  // 目录树右键菜单 (Tree Context Menu) - 1个
  hideTreeContextMenu,
  
  // 目录树节点编辑 (Tree Node Edit) - 2个
  treeNodeConfirm, treeNodeCancel,
  
  // 确认对话框 (Confirm Dialog) - 2个
  confirmOk, confirmCancel,
  
  // 提示对话框 (Alert Dialog) - 2个
  alertClose, alertConfirm
}
```

**技术实现**：
- 新增 `matchKeyBinding(event, binding)` 函数：通用快捷键匹配逻辑
- 重构 `handleKeyDown()` 函数：从配置读取快捷键
- 重构 `handleGlobalKeyDown()` 函数：弹出窗口也使用配置驱动
- 重构 `handlePopupKeyDown()` 函数：统一使用配置

**配置文件注释增强**：
- 添加完整的键位映射表格（键盘符号 → 配置值）
- 修饰键说明采用表格格式，清晰展示 Mac/Windows 映射
- 每个快捷键添加中文注释说明功能用途
- 按面板分组，便于快速定位

**用户价值**：
- 支持通过 DevTools Console 自定义快捷键
- 保持向后兼容，默认值与原硬编码行为一致
- 为未来添加设置界面预留空间

### 影响文件

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `manifest.json` | 修改 | 版本号更新：1.2.6 → 1.2.7 |
| `scripts/config.js` | 修改 | 新增 keyBindings 配置项，包含 24 个快捷键配置 |
| `popup.js` | 修改 | 新增 matchKeyBinding() 函数，重构键盘事件处理函数 |

---

## [1.2.6] - 2026-01-26

### 新增功能

#### 编辑窗口目录树键盘导航增强
本次更新为编辑弹窗的目录树添加了完整的键盘导航功能，显著提升了用户在目录树中的操作效率。

##### 1. 上下导航（↑ ↓）
**功能特性**：
- 在目录树中选中节点后，按 ↑ ↓ 方向键可快速切换到相邻的可见节点
- 自动跳过禁用节点（置灰节点）
- 支持循环导航：
  - 在顶部节点按 ↑ 键，自动跳转到底部节点
  - 在底部节点按 ↓ 键，自动跳转到顶部节点
- 自动滚动：选中节点自动滚动到可视区域

**技术实现**：
- `navigateTree(direction)` 函数：处理上下导航逻辑
- `getVisibleTreeNodes()` 函数：获取所有可见且可选中的节点
- 在 `handleGlobalKeyDown()` 中统一处理键盘事件（优先级6）

##### 2. 展开/折叠导航（→ ←）
**功能特性**：
- 在目录树中选中有子节点的文件夹后：
  - 按 → 键：展开当前选中节点
  - 按 ← 键：折叠当前选中节点
- 幂等性设计：
  - 已展开的节点按 → 键不会重复执行
  - 已折叠的节点按 ← 键不会重复执行
  - 叶子节点（无子节点）按 → ← 键无响应
- 视觉反馈：折叠/展开图标即时变化

**技术实现**：
- `expandSelectedNode()` 函数：展开选中节点
- `collapseSelectedNode()` 函数：折叠选中节点
- 复用现有的展开/折叠逻辑（toggle.classList、childrenContainer.style.display）

##### 3. 完整的键盘导航体系
**导航能力组合**：
- ↑ ↓：节点间快速切换
- → ←：节点层级展开/折叠
- Enter：保存编辑
- ESC：取消编辑

**用户体验提升**：
- 无需鼠标即可完成目录树的所有导航操作
- 循环导航让用户在大型目录树中更流畅地移动
- 键盘操作与点击行为保持一致

### UI 优化

#### 编辑窗口目录树添加"位置"标签
**功能概述**：
- 在编辑窗口目录树上方添加"位置"标签
- 说明目录树的用途：选中的节点即为编辑项的存放位置

**设计规范**：
- 标签文本：**"位置"**（简洁明确）
- 样式一致性：复用 `.edit-label` 样式（13px、#4a5568、500字重）
- 布局位置：独占一行，位于目录树正上方
- 无背景色：与"名称"、"网址"标签保持一致

**技术实现**：
- `popup.html`：在 `.edit-tree-field` 中添加 `<label class="edit-label edit-tree-label">位置</label>`
- `popup.css`：添加 `.edit-tree-label` 样式（display: block, margin-bottom: 6px）

**用户体验**：
- 提供清晰的上下文提示，帮助用户理解目录树的作用
- 视觉层次清晰，不影响原有布局

### 影响文件

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `manifest.json` | 修改 | 版本号更新：1.2.5 → 1.2.6 |
| `popup.html` | 修改 | 在 edit-tree-field 中添加"位置"标签 |
| `popup.css` | 修改 | 添加 .edit-tree-label 样式 |
| `popup.js` | 修改 | 新增键盘导航函数：navigateTree、getVisibleTreeNodes、expandSelectedNode、collapseSelectedNode |

---

## [1.2.5] - 2026-01-25

### 新增功能

#### 目录树右键管理功能
本次更新在编辑弹窗的目录树中新增了完整的右键管理功能，使得文件夹管理更加便捷高效。

**功能入口**：
- 在编辑弹窗的目录树节点上点击右键
- 弹出上下文菜单，显示三个管理选项

**三项管理功能**：

| 功能 | 图标 | 说明 |
|------|------|------|
| **修改** | ✏️ | 直接进入目录树节点的编辑态，修改文件夹名称，支持Enter保存、ESC取消 |
| **删除** | 🗑️ | 删除选中的文件夹节点，弹出确认对话框防止误删除 |
| **新建文件夹** | 📁 | 在当前选中节点下新建子文件夹，自动进入编辑态 |

##### 1. 修改功能（重命名）
**功能特性**：
- 直接在目录树中原位编辑文件夹名称
- 编辑态视觉反馈：节点背景高亮，文本框自动全选
- 支持键盘操作：
  - Enter 键保存修改
  - ESC 键取消编辑
  - 光标可随意定位修改
- 点击其他区域自动保存当前编辑

**技术实现**：
- `handleRenameFolder()` 函数处理重命名逻辑
- 直接在目录树 DOM 中创建输入框，无需弹窗
- 阻止点击和鼠标事件冒泡，避免误触
- 保存后刷新目录树显示

##### 2. 删除功能
**功能特性**：
- 删除选中的文件夹节点及其所有子节点
- 自动保存当前编辑：如果正在编辑节点，会先自动保存
- 确认对话框：复用编辑弹窗的确认对话框，防止误删除
- 根节点保护：
  - 浏览器内置节点（如"书签栏"、"其他书签"等）禁止删除
  - 弹出自定义提示对话框，友好提示用户
- 自动刷新：删除成功后自动刷新目录树

**技术实现**：
- `handleDeleteTreeFolder()` 函数处理删除逻辑
- 复用 `showConfirm()` 确认对话框
- 使用 `showAlert()` 自定义提示对话框替代 alert()
- 调用 `BookmarkManager.removeBookmark()` API 删除书签数据
- 删除后调用 `buildFolderTree()` 重新构建目录树

##### 3. 新建文件夹功能
**功能特性**：
- 在当前选中节点下创建新的子文件夹
- 自动展开父节点，显示新建的文件夹
- 默认名称："新建文件夹"
- 自动进入编辑态，文本全选，方便用户直接输入名称
- 支持 Enter 保存、ESC 取消

**技术实现**：
- `handleCreateFolder()` 函数处理新建逻辑
- 调用 `chrome.bookmarks.create()` API 创建文件夹
- 创建成功后自动刷新目录树
- 定位到新节点并进入编辑态

**所见即所得设计**：
- 目录树内的所有修改操作不需要点击编辑弹窗的"保存"按钮
- 重命名、新建文件夹后直接生效，无需额外操作
- 符合文件管理器的交互习惯

##### 菜单位置
- **修改**：位于第一位，使用频率最高
- **删除**：位于第二位，与搜索结果菜单位置一致
- **新建文件夹**：位于第三位，与删除操作隔离，防止误点

### Bug修复

#### 修复确认框键盘事件优先级问题
**问题描述**：
- 在编辑弹窗中，目录树节点上右键点击"删除"弹出确认框后
- 按 Enter 键或 ESC 键时，触发的是编辑窗口本身的操作，而不是确认框的操作
- 确认框无响应且不会关闭，导致交互异常

**根本原因**：
- `handleGlobalKeyDown()` 函数中的事件优先级顺序错误
- 确认对话框的检查（优先级5）晚于编辑对话框的检查（优先级4）
- 导致编辑对话框先拦截了键盘事件，确认框无法响应

**修复方案**：
- 调整 `handleGlobalKeyDown()` 中的优先级顺序
- 新的优先级顺序：
  - 优先级4：自定义提示对话框（`alertDialog`）
  - 优先级5：确认对话框（`confirmDialog`）
  - 优先级6：编辑对话框（`editDialog`）
- 确保所有模态对话框都能正确响应键盘事件

**修复效果**：
- 确认框显示时，Enter/ESC 键能正确触发确认框的操作
- 不会误触编辑窗口的保存/取消操作
- 交互逻辑符合用户预期

### 交互优化

#### 编辑保存前父节点选中校验
**优化背景**：
- 在编辑弹窗中删除目录树节点后，没有节点被选中
- 此时点击"保存"按钮，会因为没有选中目标文件夹而导致保存失败
- 原来使用浏览器 `alert()` 提示，与插件UI风格不一致

**优化方案**：
1. **保存前校验**：在 `handleSaveEdit()` 中新增父节点选中校验
2. **友好提示**：使用自定义提示对话框替代浏览器 `alert()`
3. **校验逻辑**：
   ```javascript
   // 验证3：必须选中目标文件夹
   if (!selectedFolderId) {
     await showAlert('请在目录树中选择目标文件夹');
     return;
   }
   ```

#### 自定义提示对话框
**功能概述**：
- 使用自定义弹窗替代浏览器原生 `alert()`，保持插件UI一致性
- 复用确认框的视觉风格，提供统一的用户体验

**设计规范**：
- **标题**："提示"（固定标题）
- **按钮**：仅一个"确定"按钮
- **样式**：复用确认框的半透明磨砂背景、圆角阴影等设计
- **z-index**：10002（高于确认框10001和编辑框10001，确保显示在最上层）

**交互行为**：
- 点击"确定"按钮关闭对话框
- 按 Enter 键关闭对话框
- 按 ESC 键关闭对话框
- 点击遮罩层关闭对话框

**技术实现**：
- **DOM结构**：`popup.html` 新增 `<div id="alertDialog">` 提示对话框容器
- **样式定义**：`popup.css` 新增 `.alert-dialog`、`.alert-box`、`.alert-message` 等样式
- **API方法**：
  - `showAlert(message)` - 显示提示对话框，返回 Promise
  - `hideAlert()` - 隐藏提示对话框
  - `handleAlertResponse()` - 处理提示对话框关闭操作
- **键盘事件**：在 `handleGlobalKeyDown()` 中新增提示对话框的优先级检查（优先级4，最高）

**替换范围**：
- 编辑功能的所有验证提示（名称为空、URL为空、父节点未选中等）
- 删除功能的错误提示
- 目录树删除的浏览器内置节点保护提示
- 共替换 8 处 `alert()` 调用为 `await showAlert()`

**用户体验提升**：
- 提示风格与插件界面完全一致，无浏览器原生弹窗的突兀感
- 支持键盘快捷操作（Enter/ESC），操作更高效
- 统一的模态对话框交互逻辑，符合用户习惯

### 影响文件

| 文件 | 变更类型 | 说明 |
|------|---------|------|
| `popup.html` | 修改 | 新增目录树右键菜单"删除"项，新增提示对话框DOM结构 |
| `popup.css` | 修改 | 新增提示对话框样式（.alert-dialog, .alert-box等） |
| `popup.js` | 修改 | 新增删除功能、提示对话框API、修复键盘事件优先级、添加父节点校验 |

---

## [1.2.4] - 2026-01-25

### 交互优化

#### 右键菜单交互一致性优化
本次更新修复了右键菜单的三个交互逻辑问题，使其行为与编辑窗口、删除确认窗口保持完全一致。

##### 问题修复
1. **鼠标移动选中问题**
   - **问题描述**：右键菜单弹出后，移动鼠标到其他下拉项会意外触发选中状态
   - **修复方案**：
     - 显示右键菜单时添加 `has-context-menu` 状态标记
     - 在 `handleItemMouseMove` 中检查模态状态，阻止鼠标移动时的选中更新
     - 关闭菜单时移除状态标记，恢复正常鼠标选中行为
   - **影响范围**：[popup.js](file:///Users/helchan/Space/HiProject/crx/Marsunso/popup.js#L612-L632)

2. **ESC键行为不一致**
   - **问题描述**：右键菜单显示时按ESC键会关闭整个插件面板
   - **期望行为**：按ESC键只关闭右键菜单，不关闭插件面板
   - **修复方案**：在 `handleGlobalKeyDown` 中新增右键菜单的ESC键检查（优先级最高）
   - **影响范围**：[popup.js](file:///Users/helchan/Space/HiProject/crx/Marsunso/popup.js#L160-L169)

3. **点击外部区域行为不一致**
   - **问题描述**：右键菜单显示时，点击其他下拉项会直接触发该项的操作
   - **期望行为**：点击菜单外部应只关闭菜单，不触发其他操作
   - **修复方案**：
     - 新增 `handleDocumentClickForContextMenu` 专用处理函数
     - 使用事件捕获阶段（capture phase）优先拦截点击事件
     - 检测点击位置，菜单外部点击时阻止事件传播并关闭菜单
   - **影响范围**：[popup.js](file:///Users/helchan/Space/HiProject/crx/Marsunso/popup.js#L718-L737)

##### 技术实现
- **状态管理**：通过 `has-context-menu` body class 标记模态状态
- **事件拦截**：使用捕获阶段拦截点击事件，避免冒泡到下拉项
- **统一模态检查**：在 `handleItemMouseMove` 中同时检查右键菜单、确认对话框、编辑窗口三种模态状态

##### 用户体验提升
- 右键菜单交互逻辑与其他模态窗口完全一致
- 避免误触导致的意外操作
- 提升操作的可预测性和安全性

---

## [1.2.3] - 2026-01-25

### UI/UX 优化

#### 对话框样式统一规范
本次更新对编辑对话框和删除确认框进行全面的UI样式统一，提升界面一致性和专业度。

##### 按钮样式统一
- **统一标准**：所有弹窗按钮采用编辑对话框的尺寸规格
- **内边距**：`padding: 7px 20px;`（删除确认框从 `8px 24px` 调整）
- **边框圆角**：`border-radius: 6px;`（删除确认框从 `8px` 调整）
- **字体大小**：`font-size: 13px;`（删除确认框从 `14px` 调整）
- **字体粗细**：`font-weight: 500;`（保持一致）
- **影响范围**：`.confirm-btn` 和 `.edit-btn` 现在完全一致

##### 字体大小统一
- **标题字体**：统一为 `16px`（删除确认框从 `17px` 调整）
- **消息/标签字体**：统一为 `13px`（删除确认框消息文本从 `14px` 调整）
- **输入框字体**：保持 `13px`
- **设计原则**：以编辑对话框的字体规格为基准，确保所有弹窗文本大小一致

##### 容器内边距和边框统一
- **内边距标准**：`padding: 16px 20px;`（上下16px，左右20px）
  - 删除确认框从 `padding: 24px 28px;` 调整为紧凑布局
- **边框样式**：统一使用极细边框 `border: 1px solid rgba(203, 213, 225, 0.6);`
  - 删除确认框原使用强阴影 `box-shadow: 0 20px 40px rgba(0, 0, 0, 0.12);`
  - 现改为无阴影 `box-shadow: none;`，配合细线边框实现轻盈统一的视觉效果
- **圆角**：保持 `border-radius: 12px;`
- **视觉效果**：内容距离窗口边缘更紧凑，两个对话框的视觉间距完全一致

##### 设计原则
- **参照基准**：所有弹窗样式以编辑对话框为标准，确保UI一致性
- **紧凑设计**：采用较小的内边距和字体，提升空间利用率
- **视觉统一**：使用细线边框替代阴影，界面更清爽简洁
- **专业度提升**：统一的样式规范使产品界面更加专业协调

##### 技术实现
- **样式文件**：`popup.css`
- **修改类**：`.confirm-box`, `.confirm-title`, `.confirm-message`, `.confirm-btn`
- **统一规格**：与 `.edit-box`, `.edit-title`, `.edit-label`, `.edit-btn` 保持一致
- **内存记录**：新增"弹窗按钮尺寸统一规范"、"弹窗字体大小统一规范"、"弹窗容器内边距和边框统一规范"三条开发规范记忆

---

## [1.2.2] - 2026-01-25

### 新增功能

#### 右键菜单"管理"功能
- **上下文菜单**：在搜索结果列表中，右键点击任意书签/文件夹可弹出上下文菜单
- **三项操作选项**：
  - **编辑**：修改书签名称、URL、移动位置
  - **删除**：删除书签或文件夹（包含确认对话框）
  - **管理**：打开浏览器原生书签管理器并定位到对应位置

#### 管理功能详解
- **功能入口**：右键菜单中的"管理"选项（带有⚙️图标）
- **智能定位**：
  - 对于文件夹：跳转到该文件夹在浏览器书签管理器中的位置
  - 对于书签：跳转到该书签所在的父文件夹位置
- **浏览器兼容性**：
  - 自动识别 Chrome 浏览器：生成 `chrome://bookmarks/?id={folderId}` 链接
  - 自动识别 Edge 浏览器：生成 `edge://bookmarks/?id={folderId}` 链接
  - 通过 `navigator.userAgent` 检测浏览器类型
- **智能标签页管理**：
  - 如果书签管理器标签页已打开：刷新 URL 并激活该标签页
  - 如果未打开：在新标签页中打开书签管理器
- **自动关闭**：执行管理操作后，自动关闭 popup 弹窗

#### 编辑功能
- **名称编辑**：支持修改书签或文件夹的名称
- **URL编辑**：支持修改书签的网址（文件夹自动隐藏此字段）
- **位置移动**：通过文件夹树选择器，可将书签移动到任意文件夹
- **文件夹树禁用规则**：编辑文件夹时，自身及所有子孙文件夹不可选（防止循环引用）

#### 删除功能
- **确认对话框**：删除前弹出自定义确认对话框
- **提示信息**：清晰显示要删除的项目名称和类型（书签/文件夹）
- **文件夹警告**：删除文件夹时提示将删除所有内容
- **根节点保护**：根节点（书签栏、其他书签等）不显示右键菜单，无法删除

#### 技术实现
- **BookmarkManager 扩展**：新增 `updateBookmark`、`moveBookmark`、`removeBookmark`、`getBookmarkById` 等 API
- **文件夹树构建**：新增 `getFolderTree`、`getAllFolders`、`getChildren` 等方法
- **右键菜单控制**：
  - 在 `popup.js` 中监听 `contextmenu` 事件（行 121）
  - 通过 `handleContextMenu()` 显示菜单并定位位置（行 635-680）
  - 通过 `handleManageAction()` 处理管理操作（行 786-827）
- **浏览器检测**：使用 `navigator.userAgent.includes('Edg/')` 识别 Edge 浏览器
- **标签页查询**：使用 `chrome.tabs.query()` 查找已打开的书签管理器标签页
- **缓存同步**：编辑/删除操作后自动清除缓存，确保搜索结果实时更新

## [1.2.1] - 2026-01-24

### 新增功能

#### 右键编辑功能初版
- 首次引入右键菜单编辑功能的基础框架

### UI/UX 优化

#### 编辑窗口视觉改进
- **字体大小调整**：从 14px 缩小到 13px，使界面更紧凑，更接近浏览器原生风格
- **标签和输入框对齐优化**：使用 inline-block 布局方案实现标签与输入框的精确对齐
  - 标签宽度：28px（适配两个中文字符）
  - 输入框计算：`width: calc(100% - 34px)`（总宽度 - 标签宽度 - 间距）
  - 标签与输入框间距：6px
- **间距和内边距优化**：
  - 字段间距：从 16px 调整为 12px
  - 输入框内边距：从 10px 14px 调整为 8px 10px
  - 目录树节点内边距：从 6px 8px 调整为 4px 6px
  - 文件夹图标：从 20px 缩小到 18px
  - 按钮内边距：从 8px 24px 调整为 7px 20px
- **目录树容器高度标准化**：从 `min-height: 200px; max-height: 280px` 改为固定 `height: 280px`
- **整体紧凑化设计**：在保持布局不变的前提下，通过字体、间距、内边距的统一调整，提升视觉密度，展示更多内容

#### 其他 UI 优化
- 编辑面板采用与浏览器原生书签管理器一致的设计风格
- 文件夹树支持展开/折叠、点击选中、滚动定位
- 按钮采用圆角设计，配色与主界面协调

---

## [1.1.6] - 2024-12-31

### 核心功能

#### 快捷键唤起
- 支持全局快捷键 `Ctrl+K` (Windows/Linux) 或 `Command+K` (macOS) 唤起搜索面板
- 面板已打开时重复按快捷键自动聚焦搜索框
- 短时间内重新打开自动恢复上次搜索内容（1.5秒缓存）

#### 智能搜索模式
- **默认模式**：搜索框为空时展示所有二级书签
- **模糊搜索模式**：支持书签名称、URL、拼音多维度匹配
  - 单关键词搜索：匹配书签标题或 URL
  - 多关键词搜索：支持层级匹配（如 `学习 读书` 在"学习"目录下搜索"读书"）
- **路径导航模式**：使用 `/` 开头精确导航到指定目录
  - 精确路径：`/学习/课程` 直接进入目录
  - 路径搜索：`/学习/课程 语文` 在指定路径下搜索
  - 末尾斜杠：`/学习/课程/` 展示目录所有子项

#### 拼音匹配算法
- **全拼匹配**：`woaixuexi` → "我爱学习"
- **首字母匹配**：`wxxx` → "我爱学习"
- **混合输入匹配**：`w学xi` → "我爱学习"（拼音与汉字混合）
- **非连续汉字匹配**：`我学` → "我爱学习"（跳跃式匹配）
- **顺序匹配**：允许跳过字符的序列匹配
- 支持多音字、生僻字（基于 `pinyin-pro` 库）

#### 层级匹配机制
- 分层独立匹配策略，每层使用完整的拼音匹配算法
- 支持跳层匹配（关键词数量 < 路径层级）
- 距离书签越近的层级权重越高（0.7 ~ 1.0）
- 智能路径高亮，精确显示匹配位置

#### 键盘操作
- `Ctrl+K` / `Command+K` - 打开/聚焦搜索面板
- `↑` / `↓` - 上下选择书签
- `Cmd/Ctrl + ←` / `→` - 跳转到第一项/最后一项
- `Enter` - 打开书签（新标签页）或进入目录
- `Ctrl/Cmd + Enter` - 后台打开书签（保持面板）
- `Cmd/Ctrl + ↑` - 返回上层目录
- `Cmd/Ctrl + ↓` - 进入目录或后台打开书签
- `Cmd/Ctrl + Backspace` - 清空搜索框
- `Esc` - 关闭面板

#### 鼠标操作
- 单击书签 - 新标签页打开并切换
- `Ctrl + 单击` - 后台打开，保持当前页面
- 单击文件夹 - 进入该文件夹

#### 用户界面
- Spotlight 风格设计，简洁美观的半透明磨砂背景
- 自动获取网站 Favicon 图标
- 文件夹使用专属图标（Base64 内嵌）
- 选中项高亮显示，滚动自动跟随
- 响应式布局，适配不同屏幕尺寸

#### 性能优化
- 输入防抖处理（150ms 延迟，可配置）
- 书签数据、拼音数据、图标 URL 内存缓存
- Favicon 预加载，消除图标加载延迟
- 路径拼音预生成，避免匹配时重复计算
- 搜索结果数量限制（默认 50 条，可配置）
- 下拉列表显示限制（最多 12 项）
- DocumentFragment 批量插入 DOM
- 事件委托减少监听器数量

#### 配置管理
- 支持自定义最大结果数量（`maxResults`，默认 50）
- 支持自定义搜索防抖延迟（`searchDelay`，默认 150ms）
- 配置云同步（基于 `chrome.storage.sync`）
- 支持主题设置（`theme`，light/dark）
- 支持拼音搜索开关（`enablePinyin`，默认开启）

#### 安全特性
- 输入清理：过滤危险字符（引号、尖括号、反斜杠等）
- 所有数据本地处理，不上传任何信息
- 不收集用户浏览记录或书签内容
- 不使用第三方统计或分析服务

#### 技术架构
- Manifest V3 标准
- 原生 JavaScript (ES6+)
- 模块化设计：搜索引擎、书签管理、拼音工具、配置管理
- Chrome Extensions API：bookmarks, tabs, storage, commands
- 第三方库：`pinyin-pro` (拼音处理)
- 图标服务：Google Favicon API

#### 浏览器兼容性
- Google Chrome 88+
- Microsoft Edge 88+
- 其他 Chromium 88+ 浏览器

### 测试覆盖
- 路径回退算法测试
- 层级匹配算法测试
- 拼音匹配算法测试
- 路径导航功能测试
- 路径高亮功能测试
- 配置管理模块测试
- 综合功能测试

---

## 版本说明

- 版本号格式：`主版本号.次版本号.修订号`
- 主版本号：重大功能变更或架构调整
- 次版本号：新增功能或重要改进
- 修订号：Bug 修复或小幅优化

---

## 后续规划

以下功能将根据用户反馈和需求优先级逐步实现：

- ✅ **书签编辑功能**：已实现（v1.1.7）
- ⏳ 搜索历史记录：扩展搜索范围，支持浏览历史快速访问
- ⏳ 书签失效检测：定期检查 URL 可访问性，标记失效书签
- ⏳ 虚拟滚动优化：应对超大量书签的性能优化
- ⏳ 书签统计分析：使用频率、分类统计等

---

## 许可证

本项目采用 [Apache License 2.0](LICENSE) 开源协议。

---

## 贡献

欢迎提交 Issue 和 Pull Request！

- 报告问题：[GitHub Issues](https://github.com/Helchan/Marsunso/issues)
- 功能建议：[GitHub Issues](https://github.com/Helchan/Marsunso/issues)
- 代码贡献：[GitHub Pull Requests](https://github.com/Helchan/Marsunso/pulls)
